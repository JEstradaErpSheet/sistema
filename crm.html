    <!-- Script específico para esta página (VERSIÓN DE DEPURACIÓN) -->
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            console.log("Página cargada, iniciando scripts de depuración...");

            // 1. Proteger la página
            console.log("Paso 1: Ejecutando checkAuth() para proteger la página.");
            checkAuth(); // Esto redirigirá si no hay sesión.

            // 2. Intentar cargar el iframe
            console.log("Paso 2: Intentando cargar el iframe de AppSheet.");
            
            try {
                // Obtenemos la sesión para asegurarnos de que estamos logueados
                const { data: { session } } = await supabaseClient.auth.getSession();

                if (session) {
                    console.log("Sesión encontrada para el usuario:", session.user.email);

                    // Buscamos el elemento del iframe en el HTML
                    const iframeElement = document.getElementById('app-iframe');
                    
                    if (iframeElement) {
                        console.log("Elemento iframe encontrado en el HTML. Procediendo a establecer la URL.");
                        const appUrl = 'https://www.appsheet.com/start/66f3eb3b-2460-4cdb-a9a8-335a038cbb67';
                        const embedUrl = `${appUrl}&useremail=${encodeURIComponent(session.user.email)}&embed=true`;
                        
                        iframeElement.src = embedUrl;
                        console.log("¡ÉXITO! URL del iframe establecida:", embedUrl);
                    } else {
                        // ¡¡¡ ESTE ES EL ERROR MÁS PROBABLE !!!
                        console.error("¡FALLO CRÍTICO! Elemento iframe con id 'app-iframe' NO encontrado en el HTML.");
                    }
                } else {
                    console.error("Fallo: No se encontró una sesión de usuario activa después de checkAuth. Esto no debería pasar.");
                }
            } catch (error) {
                console.error("Ocurrió un error inesperado durante el proceso de carga del iframe:", error);
            }
        });
    </script>
